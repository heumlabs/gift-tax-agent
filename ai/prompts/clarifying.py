"""
Clarifying 단계 프롬프트 및 질문 템플릿

Issue #23에서 정의한 파라미터 추출 프롬프트, 9개 변수 질문 템플릿, 답변 합성 프롬프트를 포함합니다.

참조:
- docs/prd_detail/ai-logic/04-clarifying-implementation-spec.md (섹션 2.1, 3.1, 4.1)
- docs/prd_detail/ai-logic/04-clarifying-strategy.md (9개 변수 정의)
"""

# ============================================================================
# 파라미터 추출 프롬프트 (Gemini API용)
# ============================================================================

PARAMETER_EXTRACTION_PROMPT = """당신은 증여세 계산을 위한 정보 추출 전문가입니다.

사용자 메시지에서 다음 9개 변수를 추출하세요. 언급되지 않은 변수는 null로 설정합니다.

### 변수 목록

**Tier 1 (필수 기본 정보)**
1. gift_date: 증여일 (YYYY-MM-DD 형식 문자열)
2. donor_relationship: 증여자 관계 ("배우자"|"직계존속"|"직계비속"|"기타친족")
3. gift_property_value: 증여재산가액 (숫자)

**Tier 2 (특례 판단)**
4. is_generation_skipping: 세대생략 여부 (true|false)
5. is_minor_recipient: 미성년자 여부 (true|false)
6. is_non_resident: 비거주자 여부 (true|false)

**Tier 3 (공제 및 채무)**
7. marriage_deduction_amount: 혼인공제액 (숫자, 0~100000000)
8. childbirth_deduction_amount: 출산공제액 (숫자, 0~100000000)
9. secured_debt: 담보채무액 (숫자)

### 파싱 규칙

**금액 변환**:
- "1억" → 100000000
- "5천만원" → 50000000
- "3억5천" → 350000000
- "200만원" → 2000000
- "100,000,000원" → 100000000

**날짜 변환** (기준일: {today}):
- "오늘" → {today}
- "어제" → {yesterday}
- "이번 달 15일" → {this_month_15th}
- "2025년 10월 15일" → "2025-10-15"
- "10/15" → "{current_year}-10-15"
- "올해 6월" → "{current_year}-06-01" (월만 언급 시 1일로 처리)
- "올해 3월" → "{current_year}-03-01"
- "작년 12월" → "{last_year}-12-01"
- "6월 15일" → "{current_year}-06-15"

**관계 매핑** (수증자 기준):
- "부모", "부모님", "아버지", "어머니" → "직계존속"
- "자녀", "아들", "딸" → "직계비속"
- "배우자", "남편", "아내" → "배우자"
- "형제", "자매", "친척", "삼촌" → "기타친족"
- "조부모", "할아버지", "할머니" → "직계존속"
- "손자", "손녀" → "직계비속"

**불린 변환**:
- "조부모가 손자에게", "세대를 건너뛴" → is_generation_skipping: true
- "미성년자", "미성년", "만 19세 미만" → is_minor_recipient: true
- "비거주자", "해외 거주", "외국 거주" → is_non_resident: true

**공제액**:
- "혼인 관련", "결혼 전후" → marriage_deduction_amount에 금액 또는 100000000 (최대)
- "출산 관련", "아이 출생" → childbirth_deduction_amount에 금액 또는 100000000 (최대)

**채무**:
- "대출", "담보", "임대보증금" → secured_debt에 금액

### 출력 형식

**중요**: JSON 형식만 출력하세요. 다른 텍스트나 설명은 포함하지 마세요.

```json
{{
  "gift_date": "2025-10-15" 또는 null,
  "donor_relationship": "직계존속" 또는 null,
  "gift_property_value": 100000000 또는 null,
  "is_generation_skipping": false,
  "is_minor_recipient": false,
  "is_non_resident": false,
  "marriage_deduction_amount": 0,
  "childbirth_deduction_amount": 0,
  "secured_debt": 0
}}
```

### 사용자 메시지

{user_message}

{context}
"""

# ============================================================================
# 질문 템플릿 (9개 변수)
# ============================================================================

CLARIFYING_QUESTIONS = {
    # Tier 1: 필수 기본 정보
    "gift_date": """증여일이 언제인가요?

💡 증여세는 증여일을 기준으로 신고 기한(3개월)과 공제액이 결정됩니다.
예시: 2025년 10월 15일, 올해 3월""",

    "donor_relationship": """증여하시는 분과의 관계가 어떻게 되시나요?

💡 관계에 따라 공제 한도가 다릅니다:
• 배우자: 6억원
• 부모/자녀: 5천만원
• 기타 친족: 1천만원

선택지: 배우자, 부모님, 자녀, 조부모, 기타""",

    "gift_property_value": """증여받으신 재산의 가액이 얼마인가요?

💡 평가 기준:
• 부동산: 최근 6개월 매매가 또는 공시지가
• 주식: 상장(2개월 평균), 비상장(평가액)

예시: 5억원, 200,000,000원""",

    # Tier 2: 특례 판단
    "is_generation_skipping": """조부모님께서 손자/손녀에게 직접 증여하시는 경우인가요?

⚠️ 세대를 건너뛴 증여: 산출세액의 30% 할증
(단, 부모님이 이미 사망하신 경우 제외)

선택지: 예 / 아니오""",

    "is_minor_recipient": """증여받으시는 분이 미성년자(만 19세 미만)인가요?

💡 미성년자 공제: 직계존속으로부터 증여 시 2천만원
(성인: 5천만원)

선택지: 예 / 아니오""",

    "is_non_resident": """증여받으시는 분이 해외에 거주 중이신가요?

💡 비거주자: 1년 중 183일 이상 해외 거주

선택지: 예 / 아니오""",

    # Tier 3: 공제 및 채무
    "marriage_deduction_amount": """혼인 전후 2년 이내에 증여받으신 것인가요?

💡 혼인일 전후 각 2년(총 4년) 이내 증여 시 최대 1억원 추가 공제

선택지: 예(금액 입력) / 아니오""",

    "childbirth_deduction_amount": """자녀 출생 2년 이내에 증여받으신 것인가요?

💡 자녀 출생일로부터 2년 이내 증여 시 최대 1억원 추가 공제

선택지: 예(금액 입력) / 아니오""",

    "secured_debt": """증여받은 재산에 담보대출이나 임대보증금이 있나요?

💡 부담부 증여: 증여자의 채무를 수증자가 인수하는 경우
예시: 5억 아파트 + 2억 대출 = 실제 증여가액 3억

선택지: 없음(0원) / 있음(금액 입력)"""
}

# ============================================================================
# 답변 합성 프롬프트 (계산 결과 → 자연어)
# ============================================================================

SYNTHESIS_PROMPT = """당신은 증여세 계산 결과를 명확하게 설명하는 AI입니다.

아래 계산 결과를 바탕으로 사용자에게 정확하고 간결하게 설명해주세요.

### 계산 결과

**최종 세액**: {final_tax:,}원
**증여재산가액**: {gift_value:,}원
**공제액**: {total_deduction:,}원
**과세표준**: {taxable_base:,}원
**적용 세율 구간**: {tax_bracket_info}

### 계산 단계
{steps_formatted}

### 주의사항
{warnings_formatted}

---

다음 규칙을 따라 답변하세요:

**형식**:
1. **결과 요약**: 관계와 금액을 언급하며 최종 세액 제시
2. **계산 과정 설명**: 주요 단계를 2-3문장으로 설명 (증여재산가액, 공제액, 과세표준, 세율 구간)
3. **주의사항 안내**: warnings 내용을 그대로 전달

**톤**:
- 불필요한 인사말("안녕하세요", "문의하신") 제거
- 간결하고 명확한 문장 사용
- 핵심 정보 위주로 작성

**필수 포함 사항**:
- 과세표준 금액과 해당 세율 구간 (예: "과세표준 99억 5천만원은 30억 초과 구간으로 50% 세율 적용")
- warnings에 신고기한 경과 경고가 있으면 강조
- 답변 끝: "본 안내는 정보 제공용이며, 정확한 세액은 세무 전문가와 상담하시기 바랍니다."
"""
