## PRD: 슈킹(Syuking) — 증여세/상속세 AI 상담 서비스

문서 버전: v0.9 (초안)  
문서일: 2025-10-13  
문서 소유: Product 팀  
연관 문서: `docs/idea.md`

### 1) 배경과 문제 정의
- **문제**: 일반 사용자는 증여세/상속세 관련 규정과 계산 방식이 복잡해 전문가 도움 없이 의사결정을 내리기 어렵다. 기존 LLM 챗봇은 답변의 전제조건과 예외, 필요한 추가 정보에 대한 안내가 부족해 실무적 의사결정에 쓰기 어렵다.
- **기회**: 
  - 상담형 대화 흐름(clarifying 질문 → 조건 확정 → 대안 제시)과 최신 법령/예규 인용을 결합하면 신뢰성 높은 조언을 제공할 수 있다.
  - 간단한 세부 변수만으로 1차 계산치를 제시하고, 필요한 서류와 다음 액션을 안내하면 높은 실용성을 제공한다.
- **가설**: 상담형 AI가 일반 LLM 대비 요구 정보 식별과 대안 제시 측면에서 더 높은 과업 완성도와 사용자 신뢰를 확보한다.

### 2) 제품 목표와 비전
- **비전**: 개인의 증여/상속 의사결정을 돕는 최고의 AI 세무 상담사.
- **1차 목표(MVP)**:
  - 채팅 기반 상담으로 증여세/상속세 추정 계산을 제공
  - 답변의 근거(법령/예규/해석 사례) 인용 및 링크 제공
  - 세션/대화 이력 저장 및 재개
- **정량 목표(런칭+60일)**:
  - 세션 재방문율 25% 이상
  - 최초 답변까지 p50 5s 이하 / p95 15s 이하
  - 출처 클릭률(법령 링크) 15% 이상
  - 대화 종료 시 “도움이 되었음” 피드백 70% 이상

### 3) 범위(Scope) / 비범위(Out of Scope)
- **범위**:
  - 증여세/상속세 기본 개념 설명, 과세표준 추정, 공제·감면 적용 가이드
  - 핵심 변수를 묻는 상담형 대화(거주자 여부, 친족관계, 재산 유형/평가액, 특례 적용 가능성 등)
  - 최신 법령/예규 조각을 RAG로 인용, `Gemini` 검색도구로 보조 사실 조회
  - 세션·메시지 저장, 좌측 목록에서 세션 불러오기, 신규 세션 생성
- **비범위(초기)**:
  - 사용자 로그인/소셜 인증(→ `localStorage`의 익명 `clientId`로 대체)
  - 신고서 자동 작성/전자신고 연동
  - 실명·민감정보 수집 및 저장

### 4) 타깃 사용자와 페르소나
- **페르소나 A — 예비 증여자**: 부모/조부모. 자녀에게 자금/부동산 증여를 고려. 목표: 세 부담 추정, 분할/시기 조절 전략.
- **페르소나 B — 상속 예정자**: 상속 재산·채무 정리, 공제/감면 가능성 파악. 목표: 대략적 세액, 필요 서류 체크리스트.
- **페르소나 C — 일반 사용자**: 단순 질의(기초공제, 신고 기한, 증빙). 목표: 빠른 규정 확인과 출처 링크.

### 5) 핵심 사용자 여정(요약)
1. 랜딩 → "새 상담" 클릭 → 자동 생성된 `clientId`로 세션 생성
2. 초기 질문(자유 질의 또는 템플릿): “부모가 자녀에게 1억원 증여 시 세금?”
3. 챗봇의 추가 질문: 거주자 여부, 관계, 연령, 과거 10년 내 증여 이력, 재산 유형 등
4. 1차 계산 결과와 근거 인용(법령 조각, 예규 링크), 대안 비교(분할, 특례 적용 등)
5. 다음 단계 안내: 필요 서류, 신고 기한, 유의점(비고/예외)
6. 세션 저장 → 좌측에서 재개. 응답 복사/공유 가능

### 6) 핵심 기능 요구사항
- **채팅**:
  - 사용자 메시지 전송 시 즉시 타이핑 인디케이터/로딩 애니메이션(GSAP) 표시
  - 답변은 REST 응답으로 반환(스트리밍은 v1.1에서 검토). 긴 답변은 단계적 출력 애니메이션
  - 메시지별 출처(법령/예규) 배지와 외부 링크 제공
- **세션 관리**:
  - 좌측 세션 목록(최신순), 제목 편집, 세션 생성/삭제
  - 세션 재개 시 이전 대화 컨텍스트 적용
- **사용자 식별**:
  - 최초 방문 시 `clientId`(UUID) 생성 후 `localStorage` 저장
  - 요청 시 `x-client-id` 헤더 전송. 서버는 해시 후 저장
- **계산 엔진(설명형)**:
  - 증여세/상속세 계산에 필요한 변수 수집 → 계산 → 전제/예외 명시
  - 최신 규정 숫자(공제·세율)는 설정값에서 로드하여 독립 관리
- **출처 인용(RAG+검색)**:
  - 법령/예규 문서 조각 추출·요약·하이라이트, 각 조항 링크 제공
  - Gemini 검색도구로 최신 사례·보도자료 보조 탐색(레퍼런스로만 제시)

### 7) 비기능 요구사항(NFR)
- **성능**: 최초 응답 p50 5s, p95 15s. 동시 세션 200 p95 20s 내.
- **가용성**: 99.9% 월간 가용성. 장애 시 간단한 텍스트 폴백 답변 제공.
- **보안/프라이버시**: PII 미수집. `clientId`는 서버 저장 전 SHA-256 해시. 데이터는 KMS로 암호화.
- **준법**: 법률·세무 자문이 아닌 정보 제공임을 명시. 최신성 고지 및 출처 링크 제공.
- **비용**: 세션당 LLM 토큰 12k 토큰 이내 목표. 문서 임베딩은 오프라인 배치.

### 8) 기술 스택 및 아키텍처(개요)
- **프런트엔드**: Vue3 + Vite + TypeScript + Tailwind CSS 3 + GSAP
- **백엔드**: AWS Chalice(Python) + PostgreSQL. 벡터 검색은 pgvector 또는 별도 벡터 스토어
- **LLM**: Google Gemini 2.5 Pro(+ 검색도구). 필요 시 OpenAI 대체 경로 준비
- **문서/RAG**: 법제처·국세청 공개 문서 파이프라인 → 파서 → 청크 → 임베딩 → 인덱스
- **로그/모니터링**: CloudWatch 로그, 메트릭(응답시간·오류율·토큰 사용량), 알람
- **CD/배포**: GitHub Actions → Chalice 배포, 프런트는 CDN 배포

아키텍처 흐름(텍스트):
사용자 → 브라우저(Vue) → REST(API Gateway/Chalice) → 대화 파이프라인(세무 변수 수집/검증 → RAG 컨텍스트 조합 → LLM 호출 → 결과 후처리/계산) → DB(PostgreSQL: 세션/메시지/설정/출처) → 응답 반환

### 9) 데이터 모델(초안)
- `clients`(선택): `client_id_hash`, `created_at`
- `sessions`: `id(UUID)`, `client_id_hash`, `title`, `created_at`, `updated_at`
- `messages`: `id`, `session_id`, `role(user|assistant|system)`, `content(TEXT)`, `citations(JSONB)`, `tool_calls(JSONB)`, `tokens_in`, `tokens_out`, `latency_ms`, `created_at`
- `sources`: `doc_id`, `law_name`, `article`, `url`, `chunk_id`, `vector`, `text`
- `tax_rule_config`: `key`, `value_json`, `effective_from`, `effective_to`

인덱스: `sessions(client_id_hash, created_at desc)`, `messages(session_id, created_at)`, `sources(vector)`, `sources(law_name, article)`

### 10) API 설계(초안, REST)
- `POST /api/sessions` — 새 세션 생성
  - 헤더: `x-client-id`
  - 응답: `{ id, title, createdAt }`
- `GET /api/sessions` — 세션 목록(최신순, 페이지네이션)
- `GET /api/sessions/{id}` — 세션 상세
- `PATCH /api/sessions/{id}` — 제목 변경
- `DELETE /api/sessions/{id}` — 세션 삭제
- `GET /api/sessions/{id}/messages?cursor&limit` — 메시지 목록(무한 스크롤)
- `POST /api/sessions/{id}/messages` — 사용자 메시지 등록 및 답변 생성
  - 바디: `{ content, contextOptions? }`
  - 응답: `{ messageId, assistant: { content, citations, calc, alternatives } }`

요청 공통: 헤더 `x-client-id`, `x-session-id`(옵션). 서버는 `clientId`를 해시 보관.

### 11) 프런트 UX 요구사항
- **레이아웃**: 좌측 세션 목록, 우측 대화. 상단 "새 상담" 버튼.
- **로딩 표현**: 
  - 메시지 전송 직후 타이핑 인디케이터와 GSAP 기반 점프/페이드 애니메이션(최소 400ms 표시)
  - 긴 답변은 단락별 순차 등장
- **출처 표시**: 답변 하단에 배지(법령명/조문번호). 클릭 시 새 탭으로 링크.
- **컨트롤**: 복사 버튼, 피드백 버튼(👍/👎), 재생성, 이어서 묻기 템플릿
- **접근성**: 키보드 네비게이션, 명도 대비 4.5:1 이상, 스크린리더 라벨

### 12) 상담 대화 흐름(샘플)
1) 사용자: “배우자에게 현금 1억원 증여 시 세금 얼마나 내나요?”
2) 시스템: 부족 변수 확인(거주자/과거 10년 증여액/자금 출처 등) → 질문 세트
3) 사용자: 답변 제공
4) 시스템: 
   - 가정 명시(예: 국내 거주자, 과거 증여 없음 등)
   - 과세표준 계산식 전개 및 공제/특례 적용 여부 명확화
   - 대안: 시기 분산, 재산 유형 변경, 특례 적용 가능성
   - 근거 인용(법령/예규)과 링크
5) 사용자: 후속 질문 → 반복

### 13) 세무 계산 로직(명세, 고정값은 설정에서 주입)
- **공통**:
  - 입력 변수: 관계, 거주자 여부, 연령, 과거 10년 증여 이력, 재산 유형/평가액, 채무·부담부 여부, 특례 대상 여부 등
  - 결과: 과세가액, 과세표준, 산출세액, 세액공제/가산세, 추정 납부세액, 신고 기한
  - 규정 수치(기초공제, 세율구간 등)는 `tax_rule_config`에서 버전 관리. 
- **증여세(예시 식)**:
  - 과세가액 = 증여재산가액 − 비과세/감면 항목
  - 과세표준 = 과세가액 − 공제(관계·연령 등 조건별)
  - 산출세액 = 세율표(누진)를 적용
  - 세액공제·가산세 = 신고기한, 자진납부, 합산 여부에 따라 가감
  - 최종 추정세액 = 산출세액 − 공제 + 가산세
- **상속세(예시 식)**:
  - 상속재산가액 = 총재산 − 공과금/장례비/채무 등
  - 과세표준 = 상속재산가액 − 공제(일괄공제/인적공제/배우자공제 등)
  - 산출세액 = 세율표 적용 → 세액공제/감면 반영
  - 유류분/사전증여 합산 고려는 상담 결과에 주석으로 명시
  
계산 엔진은 결과와 함께 “전제(Assumptions)·예외(Exceptions)·권고(Recommendations)”를 구조화해 반환.

### 14) RAG/출처 인용 규칙
- 인용은 항상 문장 단위로 표시하고 링크 제공(법제처/국세청 원문)
- LLM이 생성한 문구와 인용 구절을 시각적으로 구분(배지)
- 검색 도구의 웹 결과는 “참고자료”로만 표기하고 최종 법적 근거로 사용하지 않음
- 출처가 불충분하면 명시적으로 “불확실성” 알림 및 추가 확인 안내

### 15) 보안/프라이버시/준법
- 법률·세무 자문 대행이 아님을 매 화면 하단에 고지
- 개인식별정보 저장 금지. `clientId`는 해시 후 세션 키로만 사용
- 데이터 보관 기간 정책(예: 1년 경과 시 세션/메시지 영구 삭제)
- 관리자/개발자 접근 로깅 및 최소 권한 원칙

### 16) 성공지표(KPI)와 분석
- 코어 KPI: 세션 재방문율, 답변 도달 시간, 근거 클릭률, 긍정 피드백률
- 서브 KPI: Clarifying 질문 응답률, 평균 변수결정 단계 수, 중도 이탈률
- 비용 KPI: 세션당 토큰 사용량, 검색 호출 수
- 이벤트 로그: 세션 생성/종료, 메시지 전송, 인용 클릭, 피드백, 재생성

### 17) 장애/오류 처리
- LLM/검색 장애: 캐시된 규정 요약과 계산 엔진만으로 축약 답변 제공
- 시간 초과(>20s): 사과 메시지와 ‘나중에 재시도’ 안내, 세션 자동 저장
- 입력 누락: 필수 변수 누락 시 사용자에게 명확히 요청
- 법령 충돌/모호: 두 가지 해석을 병기하고 보수적 가정 우선

### 18) 로드맵(요약)
- **MVP(4주)**: 채팅/세션, 기본 계산 엔진, RAG 인용, 로딩 애니메이션, 기본 분석
- **v1.1(6~8주)**: 응답 스트리밍(SSE), 고급 특례 시뮬레이터, PDF 요약 내보내기
- **v1.2**: 간단 신고서 초안 생성, 문서 업로드(재산평가서) 파싱 베타

### 19) 수용 기준(샘플)
- 세션 생성/목록/삭제/제목 변경이 정상 동작하고 데이터가 DB에 반영된다
- 사용자 질의에 대해 최소 1개 이상의 clarifying 질문 후 1차 계산 결과 제공
- 각 답변에 2개 이상 근거 출처가 표시되며 링크가 유효하다
- 동일 세션에서 맥락 유지가 확인된다(최소 5턴)
- p95 응답 시간이 15s 이내(부하 100 동시 사용자)
- 로딩 애니메이션이 모든 요청에서 최소 400ms 노출된다

### 20) 오픈 이슈
- 규정 최신화 자동 파이프라인(변경 감지/검수 워크플로)
- 특례/예외의 수치 검증 체계(세무사 피드백 루프)
- 임베딩/검색 품질 개선(A/B 테스트)와 비용 균형점

### 부록 A) 예시 요청/응답 페이로드
요청 예시:
```json
POST /api/sessions/{id}/messages
{
  "content": "배우자에게 1억원 증여 시 세금?",
  "contextOptions": { "assumeResident": true }
}
```

응답 예시(요약형):
```json
{
  "messageId": "msg_123",
  "assistant": {
    "content": "가정 A,B 하에 과세표준은 X, 산출세액은 Y로 추정됩니다...",
    "citations": [
      { "law": "상속세및증여세법", "article": "제○조", "url": "https://..." }
    ],
    "calc": {
      "assumptions": ["국내 거주자", "과거 10년 증여 없음"],
      "taxBase": 100000000,
      "deductions": [
        { "type": "기초공제", "amount": 0 }
      ]
    },
    "alternatives": [
      "증여 시기 분산 시 과세표준 감소 가능",
      "재산 유형 변경 고려"
    ]
  }
}
```

### 부록 B) 프런트 상호작용 요구사항(추가)
- 입력창 엔터 = 전송, Shift+Enter = 줄바꿈
- 모바일: 키보드 오버레이 대응, 플로팅 전송 버튼
- 스크롤 위치 보정: 새 답변 시 자동 스크롤, 사용자가 스크롤 상단이면 배지로 알림
- 빈 상태(Empty State): 템플릿 질문 카드(증여/상속 각 3개) 제공

### 부록 C) 품질/테스트 체크리스트(발췌)
- 계산 엔진: 경계값/예외 케이스 단위 테스트(미성년자, 배우자, 직계존비속 등)
- RAG: 무관 문서 인용 금지 테스트, 링크 유효성 테스트
- 성능: 부하 테스트(동시 100/200 사용), 캐싱 효과 검증
- 접근성: 키보드 포커스, 색각 이상 대비 모드 검증


